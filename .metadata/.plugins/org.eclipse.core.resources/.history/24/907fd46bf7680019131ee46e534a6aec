package demo1;
import java.io.FileInputStream;
import java.io.FileOutputStream;
import java.io.IOException;

import org.apache.poi.hssf.usermodel.HSSFCell;
import org.apache.poi.hssf.usermodel.HSSFRow;
import org.apache.poi.hssf.usermodel.HSSFSheet;
import org.apache.poi.hssf.usermodel.HSSFWorkbook;
import org.apache.poi.poifs.filesystem.POIFSFileSystem;

public class T1 {

	public static void main(String[] parm){
    try{
    	FileInputStream fileIn = new FileInputStream("D:\\wjx\\demo1\\t1.xls");
        POIFSFileSystem fs = new POIFSFileSystem(fileIn);
        HSSFWorkbook wb = new HSSFWorkbook(fs);
        HSSFSheet sheet = wb.getSheetAt(0);
        sheet.setForceFormulaRecalculation(true);
        HSSFRow row = sheet.getRow(2);
        if (row == null)
            row = sheet.createRow(2);
        HSSFCell cell = row.getCell(2);
		 System.out.println(cell.getNumericCellValue());

		HSSFCell cell1 = row.getCell(3);
        if (cell1 == null)
            cell1 = row.createCell(3);
        cell1.setCellValue(5.00);
		 System.out.println(cell.getNumericCellValue());
		 cell.getCellFormula()
        // Write the output to a file
        FileOutputStream fileOut = new FileOutputStream("D:\\wjx\\demo1\\t1.xls");
//        
//        row = sheet.getRow(2);
//        HSSFCell cellS = row.getCell(2);
//
////        if (HSSFCell.CELL_TYPE_FORMULA == cellS.getCellType()) 
////        {
//		     //取得公式单元格的公式,重新设置
//			 cellS.setCellFormula(cellS.getCellFormula());
//			 System.out.println(cellS.getNumericCellValue());
////		 }else {
////			 cellS.setCellValue(value+"");// 给单元格赋String值
////		 }
			 
		wb.write(fileOut);

        sheet.setForceFormulaRecalculation(true);
       }catch(Exception e){
    	   e.printStackTrace();
       }
    
    try{
    	FileInputStream fileIn = new FileInputStream("D:\\wjx\\demo1\\t1.xls");
        POIFSFileSystem fs = new POIFSFileSystem(fileIn);
        HSSFWorkbook wb = new HSSFWorkbook(fs);
        HSSFSheet sheet = wb.getSheetAt(0);
        sheet.setForceFormulaRecalculation(true);
        HSSFRow row = sheet.getRow(2);
        HSSFCell cell = row.getCell(2);

		 System.out.println(String.valueOf(cell.getNumericCellValue()));

       }catch(Exception e){
    	   e.printStackTrace();
       }
	}
	public String getCellValue(HSSFCell cell) {
	         String value = null;
	         if (cell != null) {
	             switch (cell.getCellType()) {
	             HSSFCell.
	             case HSSFCell.CELL_TYPE_FORMULA:
	                 // cell.getCellFormula();
	                 try {
	                     value = String.valueOf(cell.getNumericCellValue());
	                 } catch (IllegalStateException e) {
	                     value = String.valueOf(cell.getRichStringCellValue());
	                 }
		38                 break;
		39             case HSSFCell.CELL_TYPE_NUMERIC:
		40                 value = String.valueOf(cell.getNumericCellValue());
		41                 break;
		42             case HSSFCell.CELL_TYPE_STRING:
		43                 value = String.valueOf(cell.getRichStringCellValue());
		44                 break;
		45             }
		46         }
		47 
		48         return value;
		49     }
}
